env:
  global:
    secure: 45e5e2694d355ffb25f43192dd33bfdb1bc22152
# This is needed to avoid building all the tags pushed by travis
branches:
  except:
   - /^v?\d+\.\d+\.\d+$/

before_install:
 - if [[ `npm -v` != 3* ]]; then npm i -g npm@3; fi
  # Create a git tag of the new version to use
  # If package.json major and minor versions match last tag, then increment last tag. Else use package.json major.minor.0.
 - git config --global user.email "xcxncu@gmail.com"
 - git config --global user.name "Cheng"
 - "{ sed -nE 's/^[ \\t]*\"version\": \"([0-9]{1,}\\.[0-9]{1,}\\.)[0-9x]{1,}\",$/\\1/p' package.json; git describe --abbrev=0 | sed -E 's/^v([0-9]{1,}\\.[0-9]{1,}\\.)([0-9]{1,})$/\\1 \\2/g'; } | tr \"\\n\" \" \" | awk '{printf($1==$2?\"v\"$2$3+1:\"v\"$1\"0\")}' | xargs -I {} git tag -a {} -m \"{}\"\n"
  # Update package.json based on the git tag we just created
 - npm --no-git-tag-version version from-git
script:
 - npm run test 
# Push the new tag back to GitHub but only if on the master branch
deploy:
 - provider: script
   skip_cleanup: true
   script: git push --tags
   on:
     branch: master
